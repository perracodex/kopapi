## Registering Custom Types

Custom types allow you to define specialized representations for your data models in the OpenAPI schema.
This section explains how to create and configure custom types using the `CustomTypeBuilder`.

---

### Understanding Custom Types

Custom types are user-defined representations that override or extend the default schema generation behavior.

They are useful for:
- Standardizing Type Formats: Ensuring consistency across similar types.
- Adding Constraints: Enforcing specific validation rules.
- Enhancing Documentation: Providing additional metadata for better API understanding.

### Syntax

```kotlin
addType<T>(type) { 
    // Configuration using CustomTypeBuilder
}
```

- `T`: The Kotlin class you want to register.
- `"type"`: The type specification to be used in the OpenAPI schema.
    - It must be one of the standard OpenAPI types:
      `array`, `boolean`, `integer`, `number`, `object`, `string`
- `CustomTypeBuilder`: A lambda that configures the custom type.

### Samples

```kotlin
addType<Data>(DataType.STRING)
addType<Length>(DataType.NUMBER) { format = "float" }
addType<CurrencyCode>(DataType.STRING) { minLength = 3; maxLength = 3 }
```

---

### Example

Suppose you want to define custom types `CurrencyCode` and `DiscountRate` with specific constraints.

```kotlin
install(Kopapi) {
    addType<CurrencyCode>(DataType.STRING) {
        minLength = 3
        maxLength = 3
    }

    addType<DiscountRate>(DataType.NUMBER) {
        format = "percentage"
        additional = mapOf("minimum" to "0", "maximum" to "100")
    }
}
```

Given a `Transaction` class using these custom types:

```kotlin
data class Transaction(
    val id: Uuid,
    val currency: CurrencyCode,
    val discount: DiscountRate
)
```

The resulting OpenAPI schema will include:

```yaml
"Transaction": {
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid"
    },
    "currency": {
      "$ref": "#/components/schemas/CustomTypeOfCurrencyCode"
    },
    "discount": {
      "$ref": "#/components/schemas/CustomTypeOfDiscountRate"
    }
  }
}
```

And the custom types:

```yaml
"CustomTypeOfCurrencyCode": {
  "type": "string",
  "minLength": 3,
  "maxLength": 3
}

"CustomTypeOfDiscountRate": {
  "type": "number",
  "format": "percentage",
  "minimum": 0,
  "maximum": 100
}
```

---

### Using CustomTypeBuilder

The `CustomTypeBuilder` facilitates the configuration of custom types by allowing
to specify various constraints and additional properties.

| Property         | Description                                                                                               |
|------------------|-----------------------------------------------------------------------------------------------------------|
| format           | Defines the expected data format (e.g., "date", "email"). Can also use custom text.                       |
| minLength        | Sets the minimum length for string values.                                                                |
| maxLength        | Sets the maximum length for string values.                                                                |
| minimum          | Defines the inclusive lower bound for numeric types.                                                      |
| maximum          | Defines the inclusive upper bound for numeric types.                                                      |
| exclusiveMinimum | Sets a strict lower bound where the value must be greater than this number.                               |
| exclusiveMaximum | Sets a strict upper bound where the value must be less than this number.                                  |
| multipleOf       | Ensures the value is a multiple of the specified number.                                                  |
| additional       | Allows adding custom properties not covered by the above fields. Useful for extending schema definitions. |

### Sample

```kotlin
install(Kopapi) {
    addType<CustomClass>(DataType.STRING) {
        format = "custom-format"
        minLength = 5
        maxLength = 10
        minimum = 1
        maximum = 100
        exclusiveMinimum = 0
        exclusiveMaximum = 200
        multipleOf = 2
        additional = mapOf("key1" to "value1", "key2" to "value2")
    }
}
```

---

### Example defining additional properties

```kotlin
install(Kopapi) {
    addType<LanguageCode>(DataType.STRING) {
        format = "iso-code"
        minLength = 2
        maxLength = 2
        additional = mapOf(
             "code" to "EN",
             "description" to "ISO 639-1 language code"
        )
    }
}
```

- Will generate the following schema:

```yaml
"CustomTypeOfLanguageCode": {
  "type": "string",
  "format": "iso-code",
  "minLength": 2,
  "maxLength": 2,
  "code": "EN",
  "description": "ISO 639-1 language code"
}
```

---

### Complete Example

```kotlin
install(Kopapi) {
    openapiJsonUrl = "api/openapi.json"
    openapiYamlUrl = "api/openapi.yaml"
    swaggerUrl = "api/swagger"
    debugUrl = "api/debug"

    servers {
        add("https://api.production.com")
        add(Url("https://api.staging.com"))
    }

    addType<CurrencyCode>(DataType.STRING) {
        minLength = 3
        maxLength = 3
    }

    addType<DiscountRate>(DataType.NUMBER) {
        format = "percentage"
        additional = mapOf("minimum" to "0", "maximum" to "100")
    }
}
```

---

### [◄ Tags](01.plugin-configuration.md) | [API usage ►](03.api-usage.md)
