## Defining Responses

Define the possible responses to an API Operation using the `response` function.

```kotlin
api {
  // Response with a body type.
  response<MyResponseType>(status = HttpStatusCode.OK) { }

  // Response without a body type.
  response(status = HttpStatusCode.OK) { }
}
```

### Multiple Content Types

Can add multiple content types to a response, if omitted, the default content type is `application/json`.

```kotlin
api {
  response<MyResponseType>(
    status = HttpStatusCode.OK, contentType = setOf(
        ContentType.Application.Json,
        ContentType.Application.Xml
    )
  ) {
    description = "Successfully retrieved the item."
    }
}
```

---

### Additional Types

```kotlin
api {
  response<MyResponseType>(status = HttpStatusCode.OK) {
    // Register an additional type.
    addType<AnotherType>()

    // Register another type to the PDF ContentType
    // instead of the default.
    addType<YetAnotherType>(
      setOf(ContentType.Application.Pdf)
    )
  }
}
```

This will result in the following OpenAPI definition:

```yaml
responses:
  "200":
    description: "MyResponseType response"
    content:
      application/json:
        schema:
          anyOf:
            - $ref: "#/components/schemas/MyResponseType"
            - $ref: "#/components/schemas/AnotherType"
      application/pdf:
        schema:
          - $ref: "#/components/schemas/YetAnotherType"
```

---

### Headers and Links to Responses

```kotlin
api {
    response<MyResponseType>(status = HttpStatusCode.OK) {
        header(name = "X-Rate-Limit") {
            description = "The number of allowed requests in the current period."
            required = true
        }
        link(operationId = "getNextItem") {
            description = "Link to the next item."
        }
    }
}
```

- **Headers properties:**
  - `name`: The name of the header.
  - `description`: A human-readable description of the header.
  - `required`: Indicates whether the header is mandatory.
  - `deprecated`: Indicates whether the header is deprecated and should be avoided.


- **Link properties:**
  - `operationId`: The name of an existing, resolvable OAS operation.
  - `description`: A human-readable description of the link.

---

### Multiple Responses in an API Operation

It is also possible to define multiple responses for an API Operation.
In such case these will be combined by their status code.

Each response can define its own content types, headers, links, and additional types.
These will be merged and grouped according to their `status code` and `Content-Type`.

```kotlin
api {
  // Status code 200 OK with a body of MyResponseType.
  response<MyResponseType>(status = HttpStatusCode.OK) {
    desription = "Example 1."
  }

  // Again status code 200 OK, but with a body of AnotherResponseType
  // and more content-types.
  response<AnotherResponseType>(
    status = HttpStatusCode.OK, contentType = setOf(
      ContentType.Application.Json,
      ContentType.Application.Xml
    )
  ) {
    description = "Example 2."
  }

  // Status code 404 Not Found.
  response(status = HttpStatusCode.NotFound) {
    description = "Not Found."
  }
}
```

- The above example will result in two grouped responses:
  - One for `200 OK` with a body of `MyResponseType` and `AnotherResponseType`.
  - Another for `404 Not Found`

```yaml
responses:
  "200":
    description: |-
      Example 1.
      Example 2.
    content:
      application/json:
        schema:
          anyOf:
            - $ref: "#/components/schemas/MyResponseType"
            - $ref: "#/components/schemas/AnotherResponseType"
      application/xml:
        schema:
          - $ref: "#/components/schemas/AnotherResponseType"
  "404":
    description: "Not found."
```

---

### Composition

The `composition` property allows to specify how multiple types associated with a Content-Type should be combined.
This can be done either at the response level or for specific content types using the `compositionFor` function.

#### Global Composition

- You can define a global composition for all content types in the response.
- This is only meaningful when multiple types are registered for the same Content-Type.
- If no composition is defined, it defaults to `AnyOf`.

```kotlin
response<MyResponseType>(status = HttpStatusCode.OK) {
  // Apply a global composition across all content types.
  composition = Composition.OneOf

  addType<AnotherType>()
}
```

#### Per Content-Type Composition

- You can override the global composition for specific content types using the `compositionFor` function.
- This allows you to combine types differently depending on the Content-Type.


- If no types or a single type is specified, the composition is ignored.
- If no composition is specified, it defaults to `AnyOf`.

```kotlin
response<MyResponseType>(status = HttpStatusCode.OK) {
  // The response will have two main content types: JSON and XML.
  contentType = setOf(ContentType.Application.Json, ContentType.Application.Xml)

  // For the JSON content type, combine multiple types using "OneOf".
  compositionFor(ContentType.Application.Json, Composition.OneOf)

  // Register another type for all content types (both JSON and XML).
  addType<AnotherType>()

  // Register a specific type for only the PDF content type.
  addType<YetAnotherType>(setOf(ContentType.Application.Pdf))
}
```

Will result in the following OpenAPI definition:

```yaml
responses:
  "200":
    description: "MyResponseType response"
    content:
      application/json:
        schema:
          oneOf:
            - $ref: "#/components/schemas/MyResponseType"
            - $ref: "#/components/schemas/AnotherType"
      application/xml:
        schema:
          anyOf:
            - $ref: "#/components/schemas/MyResponseType"
            - $ref: "#/components/schemas/AnotherType"
      application/pdf:
        schema:
          - $ref: "#/components/schemas/YetAnotherType"
```

- Note: The composition specified using `compositionFor` is applied only if the respective content type is present in the response.
- If itâ€™s not, the composition will be ignored.

#### Merging Responses and Composition Behavior

When multiple responses with the same status code are defined, they are merged based on their Content-Type and composition settings.
If the same Content-Type exists in multiple responses, the following rules apply:

- The compositionFor setting for that Content-Type will be retained.
- If no per-Content-Type composition is defined, the global composition will be used.
- If neither composition is specified, AnyOf will be the default.

--- 

### Full Example

```kotlin
api {
  response<MyResponseType>(
    status = HttpStatusCode.OK, contentType = setOf(
      ContentType.Application.Json,
      ContentType.Application.Xml
    )
  ) {
    // Optional description.
    description = "Successfully retrieved the item."

    // Optional Headers and Links.
    header(name = "X-Rate-Limit") {
      description = "The number of allowed requests in the current period."
      required = true
    }
    link(operationId = "getNextItem") {
      description = "Link to the next item."
    }

    // Optional composition.
    // Only meaningful when multiple types are registered.
    // If omitted, defaults to `AnyOf`.
    composition = Composition.AnyOf

    // Register an additional type.
    addType<AnotherType>()

    // Register another type to the PDF ContentType
    // instead of the default.
    addType<YetAnotherType>(
      setOf(ContentType.Application.Pdf)
    )
  }
}
```

### [Endpoints Security ðŸ¡²](02.6.api-usage-security.md)

#### [ðŸ¡° Request Body](02.4.api-usage-request-body.md)
